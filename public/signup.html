<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Favicon -->
    <link
      rel="shortcut icon"
      href="/assets/img/icons/icon-192x192.png"
      type="image/x-icon"
    />

    <!-- External CSS and Fonts -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/assets/css/styles.css" />

    <!-- Page Title -->
    <title>Sign Up | StayEase</title>

    <!-- EmailJS Library -->
    <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3.2.0/dist/email.min.js"></script>
    <script>
      // Initialize EmailJS
      emailjs.init("Ei7nopPNhgExd9OLX");

      // Global variable to track email verification status
      let emailVerified = false;

      // Function to send OTP to user's email
      function sendOTP() {
        const email = document.getElementById("user-email").value;
        const emailError = document.getElementById("email-error");
        const successMessage = document.getElementById("success-message");
        const otpModal = document.getElementById("otp-modal");
        const sendOtpButton = document.getElementById("send-otp-btn");
        const otpText = document.getElementById("otp-text");
        const loader = document.getElementById("otp-loader");

        // Reset error message
        emailError.textContent = "";
        emailError.style.display = "none";

        // Validate email format
        const emailPattern = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
        if (!emailPattern.test(email)) {
          emailError.textContent = "Please enter a valid email address!";
          emailError.style.display = "block";
          return;
        }

        // Generate a random 4-digit OTP
        const verificationCode = Math.floor(1000 + Math.random() * 9000);
        sessionStorage.setItem("otp", verificationCode);

        // Show loader and hide OTP text
        sendOtpButton.disabled = true;
        otpText.style.display = "none";
        loader.style.display = "inline-block";

        // Send OTP email using EmailJS
        emailjs
          .send("service_huwqanr", "template_2zvq02l", {
            to_name: "User",
            from_name: "StayEase Room rentals",
            message: `OTP : ${verificationCode}`,
            to_email: email,
          })
          .then(
            (response) => {
              console.log("Email sent successfully", response);
              successMessage.style.display = "block";
              otpModal.style.display = "flex";

              // Show the verified icon after OTP is sent
              document.getElementById("verified-icon").style.display = "inline";
            },
            (error) => {
              console.error("Email failed to send", error);
              emailError.textContent =
                "Failed to send verification email. Please try again.";
              emailError.style.display = "block";
            }
          )
          .finally(() => {
            // Reset button state
            sendOtpButton.disabled = false;
            otpText.style.display = "inline";
            loader.style.display = "none";
          });
      }

      // Function to verify the entered OTP
      function verifyOTP() {
        const enteredOTP = Array.from(
          document.getElementsByClassName("otp-input")
        )
          .map((input) => input.value)
          .join("");
        const storedOTP = sessionStorage.getItem("otp");
        const otpError = document.getElementById("otp-error");

        // Reset error message
        otpError.textContent = "";
        otpError.style.display = "none";

        // Check if entered OTP matches the stored OTP
        if (enteredOTP === storedOTP) {
          alert("OTP Verified Successfully!");
          emailVerified = true;
          document.getElementById("user-email").disabled = true;
          document.getElementById("send-otp-btn").style.display = "none";
          document.getElementById("success-message").style.display = "none";
          document.getElementById("otp-modal").style.display = "none";

          // Show password fields and submit button after email verification
          document.getElementById("password-container").style.display = "block";
          document.getElementById("submit-button").style.display = "block";
        } else {
          otpError.textContent = "Invalid OTP! Please try again.";
          otpError.style.display = "block";
        }
      }

      // Function to move focus to the next OTP input field
      function moveFocus(event, nextInputId) {
        if (event.target.value.length === 1 && nextInputId) {
          document.getElementById(nextInputId).focus();
        }
      }

      // Function to close the OTP modal
      function closeModal() {
        document.getElementById("otp-modal").style.display = "none";
      }

      // Function to toggle password visibility
      function togglePassword(id, iconId) {
        const passwordField = document.getElementById(id);
        const icon = document.getElementById(iconId);
        const isPassword = passwordField.type === "password";
        passwordField.type = isPassword ? "text" : "password";
        icon.classList.toggle("fa-eye-slash", !isPassword);
        icon.classList.toggle("fa-eye", isPassword);
      }

      // Function to validate password and confirm password fields
      function validatePassword() {
        const password = document.getElementById("password").value;
        const confirmPassword =
          document.getElementById("confirm-password").value;
        const passwordError = document.getElementById("password-error");
        const confirmPasswordError = document.getElementById(
          "confirm-password-error"
        );

        // Reset error messages
        passwordError.textContent = "";
        confirmPasswordError.textContent = "";

        let isValid = true;

        // Check password length
        if (password.length < 6) {
          passwordError.textContent = "Password must be at least 6 characters!";
          passwordError.style.display = "block";
          isValid = false;
        }

        // Check if passwords match
        if (password !== confirmPassword) {
          confirmPasswordError.textContent = "Passwords do not match!";
          confirmPasswordError.style.display = "block";
          isValid = false;
        }

        return isValid;
      }
    </script>

    <!-- Internal CSS -->
    <style>
      body {
        background-image: url("/assets/img/beams-home@95.jpg");
        background-size: cover;
        background-position: center;
        font-family: "Poppins", sans-serif;
      }
      /* Hide the default browser password eye icon */
      input[type="password"]::-ms-reveal,
      input[type="password"]::-ms-clear {
        display: none;
      }
      input[type="password"]::-webkit-credentials-auto-fill-button {
        display: none;
      }
      input[type="password"] {
        -webkit-appearance: none;
      }
      .loader {
        display: none;
        border: 2px solid transparent;
        border-top: 2px solid #fff;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      .otp-input {
        text-align: center;
        border: 1px solid #ddd;
        border-radius: 4px;
        width: 40px;
        height: 40px;
        font-size: 18px;
      }
      .otp-modal {
        background: rgba(0, 0, 0, 0.7);
      }
      #password-container,
      #submit-button {
        display: none;
      }
    </style>
  </head>
  <body
    class="bg-gray-100 flex items-center justify-center min-h-screen font-Nrj-fonts"
  >
    <form id="signup-form" action="" method="post"></form>
      <!-- Main Container -->
      <div
        class="bg-white p-8 rounded-lg shadow-lg w-96 border-[0.5px] border-gray-300"
      >
        <!-- Header Section -->
        <div class="flex justify-center items-center space-x-1 mb-4">
          <div class="flex justify-center items-center space-x-1">
            <img
              src="/assets/img/stayease logo.svg"
              class="w-8 h-8"
              alt=""
            />
            <div class="h-[1.5px] w-7 bg-gray-500 rotate-90 rounded-full"></div>
          </div>

          <h2 class="text-2xl font-semibold text-center font-Nrj-fonts">
            Sign Up
          </h2>
        </div>

        <!-- Email Form Section -->
        <div id="email-form">
          <div class="mb-4">
            <label
              for="user-email"
              class="block text-sm font-medium text-gray-700 font-Nrj-fonts"
              >Email</label
            >
            <div class="relative">
              <input
                type="email"
                id="user-email"
                name="email"
                class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:outline-none focus:border-gray-500"
                placeholder="user@gmail.com"
              />
              <i
                id="verified-icon"
                class="fa-solid fa-badge-check text-green-500 absolute right-3 top-1/2 transform -translate-y-1/2 cursor-pointer"
                style="display: none"
              ></i>
            </div>
            <p
              id="email-error"
              class="text-red-500 text-sm mt-2 font-Nrj-fonts"
            ></p>
          </div>

          <button
            id="send-otp-btn"
            type="button"
            onclick="sendOTP()"
            class="w-full bg-blue-500 text-white font-semibold py-2 px-4 rounded-md hover:bg-for font-Nrj-fonts"
          >
            <span id="otp-text">Continue</span>
            <span id="otp-loader" class="loader"></span>
          </button>
        </div>

        <!-- Password Container Section -->
        <div id="password-container">
          <div class="mt-6">
            <div class="mb-4">
              <label
                for="password"
                class="block text-sm font-medium text-gray-700 font-Nrj-fonts"
                >Password</label
              >
              <div class="relative">
                <input
                  type="password"
                  id="password"
                  name="password"
                  class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:outline-none focus:border-gray-500 font-Nrj-fonts"
                  placeholder="Enter your password"
                  minlength="6"
                  required
                  oninput="validatePassword()"
                />
                <i
                  id="password-icon"
                  class="fas fa-eye absolute top-3 right-3 cursor-pointer opacity-80"
                  onclick="togglePassword('password', 'password-icon')"
                ></i>
              </div>
              <p id="password-error" class="text-red-500 text-sm"></p>
            </div>

            <div class="mb-4">
              <label
                for="confirm-password"
                class="block text-sm font-medium text-gray-700 font-Nrj-fonts"
                >Confirm Password</label
              >
              <div class="relative">
                <input
                  type="password"
                  id="confirm-password"
                  name="confirm_password"
                  class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:outline-none focus:border-gray-500 font-Nrj-fonts"
                  placeholder="Confirm your password"
                  minlength="6"
                  required
                  oninput="validatePassword()"
                />
                <i
                  id="confirm-password-icon"
                  class="fas fa-eye absolute top-3 right-3 cursor-pointer opacity-80"
                  onclick="togglePassword('confirm-password', 'confirm-password-icon')"
                ></i>
              </div>
              <p id="confirm-password-error" class="text-red-500 text-sm"></p>
            </div>
          </div>

          <button
            id="submit-button"
            type="submit"
            class="w-full bg-blue-500 text-white font-semibold py-2 px-4 rounded-md hover:bg-for font-Nrj-fonts"
          >
            Submit
          </button>
        </div>

        <!-- Divider Section -->
        <div class="flex flex-row mt-4">
          <hr class="w-36 h-[2px] bg-gray-200 rounded-full mt-3" />
          <p class="font-Nrj-fonts font-medium text-gray-400 pl-2 pr-2">OR</p>
          <hr class="w-36 h-[2px] bg-gray-200 rounded-full mt-3" />
        </div>

        <!-- Login Link Section -->
        <p class="mt-4 text-center">
          <span class="text-black text-sm font-Nrj-fonts"
            >Already have an account?</span
          >
          <a
            href="login.html"
            class="text-blue-500 hover:underline font-Nrj-fonts"
            >Login</a
          >
        </p>

        <!-- Success Message Section -->
        <div
          id="success-message"
          class="hidden mt-4 bg-green-100 text-green-700 p-3 rounded-md text-center"
        >
          <p class="font-semibold font-Nrj-fonts">
            OTP Sent! Please check your email.
          </p>
        </div>
      </div>

      <!-- OTP Modal Section -->
      <div
        id="otp-modal"
        class="hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 border border-gray-300"
      >
        <div
          class="bg-white p-8 rounded-lg shadow-lg w-96 border-[1.5px] border-gray-400"
        >
          <div class="flex justify-between items-center mb-6">
            <h3 class="text-lg font-semibold font-Nrj-fonts">Enter The OTP</h3>
            <button
              type="button"
              onclick="closeModal()"
              class="text-gray-500 hover:text-gray-700"
            >
              <i class="fas fa-times"></i>
            </button>
          </div>
          <div class="flex justify-center space-x-4 mb-4">
            <input
              type="text"
              id="otp-input-1"
              class="otp-input w-12 h-12 text-center border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-1 focus:ring-for"
              maxlength="1"
              oninput="moveFocus(event, 'otp-input-2')"
            />
            <input
              type="text"
              id="otp-input-2"
              class="otp-input w-12 h-12 text-center border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-1 focus:ring-for"
              maxlength="1"
              oninput="moveFocus(event, 'otp-input-3')"
            />
            <input
              type="text"
              id="otp-input-3"
              class="otp-input w-12 h-12 text-center border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-1 focus:ring-for"
              maxlength="1"
              oninput="moveFocus(event, 'otp-input-4')"
            />
            <input
              type="text"
              id="otp-input-4"
              class="otp-input w-12 h-12 text-center border border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-1 focus:ring-for"
              maxlength="1"
            />
          </div>
          <button
            type="button"
            onclick="verifyOTP()"
            class="w-full bg-green-500 text-white font-medium py-2 px-4 rounded-md hover:bg-green-700"
          >
            Verify OTP
          </button>
          <p
            id="otp-error"
            class="text-red-500 text-sm mt-2 font-Nrj-fonts"
          ></p>
        </div>
      </div>
    </form>
  </body>
</html>
